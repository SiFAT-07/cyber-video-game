<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberWalk - Interactive Story Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="app">
        <!-- Loading Screen -->
        <section id="loading-screen" class="screen active">
            <div class="loader"></div>
            <p style="letter-spacing: 4px; font-weight: 800; font-size: 0.8rem; color: var(--accent-blue);">INITIALIZING SYSTEM...</p>
        </section>

        <!-- New Lobby Screen -->
        <section id="lobby-screen" class="screen">
            <div class="lobby-content" style="position: absolute; bottom: 10%; width: 100%; padding: 0 5%;">
                <h1 style="font-size: 8rem; font-weight: 800; letter-spacing: -2px; margin-bottom: 2rem; color: var(--accent-blue); text-shadow: 0 0 30px rgba(0, 210, 255, 0.5);">CYBERWALK</h1>
                <div class="menu-items" style="display: flex; gap: 20px;">
                    <button class="btn" onclick="startGame()">Play</button>
                    <button class="btn" onclick="showScreen('settings-overlay')">Settings</button>
                    <button class="btn secondary" onclick="showScreen('extras-overlay')">Extras</button>
                    <button class="btn" onclick="exitGame()">Exit Game</button>
                </div>
            </div>
        </section>

        <!-- Settings Overlay -->
        <section id="settings-overlay" class="screen glass">
            <div class="modal-content" style="width: 80%; max-width: 800px; padding: 40px;">
                <h2 style="font-size: 3rem; margin-bottom: 2rem; border-bottom: 2px solid var(--accent-blue); padding-bottom: 1rem;">SETTINGS</h2>
                
                <div class="setting-group" style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <label>GLOBAL VOLUME</label>
                        <span id="volume-val">80%</span>
                    </div>
                    <input type="range" id="volume-slider" min="0" max="100" value="80" oninput="updateSetting('volume', this.value)">
                </div>

                <div class="setting-group" style="margin-bottom: 3rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <label>SCREEN BRIGHTNESS</label>
                        <span id="brightness-val">100%</span>
                    </div>
                    <input type="range" id="brightness-slider" min="50" max="150" value="100" oninput="updateSetting('brightness', this.value)">
                </div>

                <button class="btn" onclick="showScreen('lobby-screen')">Back to Lobby</button>
            </div>
        </section>

        <!-- Extras Overlay -->
        <section id="extras-overlay" class="screen glass">
            <div class="modal-content" style="width: 80%; max-width: 800px; padding: 40px; text-align: left;">
                <h2 style="font-size: 3rem; margin-bottom: 2rem; border-bottom: 2px solid var(--accent-orange); padding-bottom: 1rem;">EXTRAS</h2>
                <div style="color: var(--text-secondary); line-height: 1.6; font-size: 1.1rem;">
                    <p style="margin-bottom: 1.5rem;"><strong>Version:</strong> 1.0.15681</p>
                    <p style="margin-bottom: 1.5rem;"><strong>Developer Notes:</strong> DISPATCH is a tactical narrative experience set in a near-future metropolitan area. Experience the life of an emergency responder in a world of high-tech surveillance and complex human stories.</p>
                    <p>All assets and UI elements are designed to provide a seamless cinematic experience.</p>
                </div>
                <button class="btn secondary" style="margin-top: 3rem;" onclick="showScreen('lobby-screen')">Back</button>
            </div>
        </section>
    </div>

    <!-- Existing Game (Hidden initially) -->
    <!-- Room Selection Screen (Formerly lobbyScreen) -->
    <div id="roomSelectionScreen" class="hidden">
        <h1>CyberWalk: Duel Mode</h1>
        <div class="lobby-controls">
            <div class="card">
                <h3>Create Room</h3>
                <button id="createRoomBtn" class="btn btn-primary">Create New Room</button>
            </div>
            <div class="card">
                <h3>Join Room</h3>
                <input type="text" id="roomIdInput" placeholder="Enter Room ID">
                <select id="roleSelect">
                    <option value="ATTACKER">Attacker (Red Team)</option>
                    <option value="DEFENDER">Defender (Blue Team)</option>
                </select>
                <button id="joinRoomBtn" class="btn btn-secondary">Join Game</button>
            </div>
        </div>
        <div id="lobbyStatus" class="status-msg"></div>
        <!-- Back Button for Navigation -->
        <button class="btn" onclick="showScreen('lobby-screen'); hideGameComponents();" style="margin-top: 2rem;">Back to Main Menu</button>
    </div>

    <!-- Attacker Dashboard -->
    <div id="attackerDashboard" class="hidden">
        <div class="dashboard-header">
            <h2>Attacker Control Panel</h2>
            <div class="room-info">Room: <span id="attackerRoomId"></span></div>
             <div class="score-board">
                Attacker: <span id="attackerScoreValue">0</span> | Defender: <span id="defenderScoreValueAtk">0</span>
            </div>
            <button class="btn btn-secondary" onclick="showScreen('lobby-screen'); hideGameComponents();" style="font-size: 0.8rem; padding: 0.5rem 1rem;">Exit</button>
            <button class="btn btn-secondary" onclick="showScreen('lobby-screen'); hideGameComponents();" style="font-size: 0.8rem; padding: 0.5rem 1rem;">Exit</button>
        </div>
        
        <!-- Scenario Selection (Stage 1) -->
        <div id="scenarioSelectionArea" class="hidden">
            <h3>Select Operation Scenario</h3>
            <div class="scenario-cards">
                <div class="scenario-card" onclick="selectScenario(1)">
                    <h4>Scenario 1: Corporate Espionage</h4>
                    <p>Target: FinEdge Global</p>
                    <span class="status active">ACTIVE</span>
                </div>
                <div class="scenario-card disabled">
                    <h4>Scenario 2: Infrastructure</h4>
                    <p>Locked</p>
                    <span class="status">LOCKED</span>
                </div>
                <div class="scenario-card disabled">
                    <h4>Scenario 3: Supply Chain</h4>
                    <p>Locked</p>
                    <span class="status">LOCKED</span>
                </div>
                <div class="scenario-card disabled">
                    <h4>Scenario 4: Ransomware</h4>
                    <p>Locked</p>
                    <span class="status">LOCKED</span>
                </div>
            </div>
        </div>

        <!-- Attack Selection (Stage 2) -->
        <div id="attackSelectionArea" class="hidden">
            <h3>Select Attack Vectors (Select 2 to Start)</h3>
            <div class="attack-cards">
                <button class="attack-card" onclick="toggleAttack('OFFICE_FAKE', this)">Deepfake Call</button>
                <button class="attack-card" onclick="toggleAttack('MFA_FAKE', this)">MFA Fatigue</button>
                <button class="attack-card" onclick="toggleAttack('WIFI_ATTACK', this)">Fake Wi-Fi</button>
                <button class="attack-card" onclick="toggleAttack('PHISHING_GROUP', this)">Group Chat Phishing</button>
            </div>
            <button id="initiateAttackBtn" class="btn btn-primary" onclick="confirmAttack()" disabled style="margin-top: 20px; width: 100%;">INITIATE ATTACK</button>
            <button class="btn secondary" onclick="backToScenarios()" style="margin-top: 10px;">Back to Scenarios</button>
        </div>
        <div id="attackerLogArea">
            <h3>Mission Log</h3>
            <ul id="missionLog"></ul>
        </div>
    </div>

    <!-- Defender Game Area -->
    <div id="defenderGameArea" class="hidden">
        <!-- Score Display -->
        <div id="scoreContainer">
            <div class="score-label">Defender Score:</div>
            <div id="defenderScoreValue">0</div>
        </div>
        
        <!-- Defender Exit Button -->
        <button class="btn btn-secondary" onclick="showScreen('lobby-screen'); hideGameComponents();" style="position: fixed; top: 20px; left: 20px; z-index: 1000; font-size: 0.8rem; padding: 0.5rem 1rem;">
            Exit
        </button>

        <!-- Video Container -->
        <div id="videoContainer">
            <video id="mainVideo" controls>
                <source src="" type="video/mp4">
                Your browser does not support the video tag.
            </video>

            <!-- Options Overlay (Hidden by default) -->
            <div id="optionsOverlay" class="hidden">
                <div id="optionButtons"></div>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="hidden">
                <div class="loader"></div>
                <p>Waiting for Attacker...</p>
            </div>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="hidden">
        <div class="game-over-content">
            <h1>Round Complete!</h1>
            <p>Defender Score: <span id="finalDefenderScore">0</span></p>
            <p>Attacker Score: <span id="finalAttackerScore">0</span></p>
            <button id="restartButton" class="btn btn-primary">Back to Lobby</button>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
