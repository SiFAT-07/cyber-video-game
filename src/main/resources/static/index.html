<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberWalk - Interactive Simulation</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="scanlines"></div>
    <div class="vignette"></div>

    <div id="app">
        <!-- Transition Overlay -->
        <div id="transitionOverlay" class="transition-overlay"></div>

        <!-- Initialize Loading Screen -->
        <section id="loading-screen" class="screen active" style="background: black; z-index: 10000;">
            <div class="loader"></div>
            <p style="margin-top: 2rem; letter-spacing: 4px; font-weight: 800; font-size: 0.8rem; color: var(--neon-blue); font-family: var(--font-display);">
                SYSTEM INITIALIZING...
            </p>
        </section>

        <!-- Main Lobby Screen -->
        <section id="lobby-screen" class="screen">
            <div class="lobby-content">
                <h1 class="lobby-title">CYBERWALK</h1>
                <div class="menu-items">
                    <button class="btn" onclick="startGame()">ENTER SIMULATION</button>
                    <button class="btn" onclick="window.location.href='editor.html'">LEVEL ARCHITECT</button>
                    <button class="btn secondary" onclick="showScreen('settings-overlay')">SYSTEM CONFIG</button>
                    <button class="btn secondary" onclick="showScreen('extras-overlay')">ARCHIVES</button>
                    <button class="btn" onclick="window.location.href='/logout'" style="border-color: var(--neon-red); color: var(--neon-red);">ABORT SESSION</button>
                </div>
            </div>
            <div style="position: absolute; bottom: 20px; right: 20px; font-size: 0.8rem; color: var(--text-muted);">
                V 2.0.4 [STABLE]
            </div>
        </section>

        <!-- Settings Overlay -->
        <section id="settings-overlay" class="screen" style="backdrop-filter: blur(5px);">
            <div class="cyber-panel" style="width: 600px; max-width: 90%;">
                <h2 style="margin-bottom: 2rem; text-align: center; border-bottom: 1px solid var(--neon-blue); padding-bottom: 1rem;">SYSTEM CONFIGURATION</h2>

                <div style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; color: var(--neon-blue);">
                        <label>AUDIO OUTPUT LEVEL</label>
                        <span id="volume-val">80%</span>
                    </div>
                    <input type="range" id="volume-slider" min="0" max="100" value="80" oninput="updateSetting('volume', this.value)">
                </div>

                <div style="margin-bottom: 3rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; color: var(--neon-blue);">
                        <label>VISUAL INTENSITY</label>
                        <span id="brightness-val">100%</span>
                    </div>
                    <input type="range" id="brightness-slider" min="50" max="150" value="100" oninput="updateSetting('brightness', this.value)">
                </div>

                <div style="text-align: center;">
                    <button class="btn" onclick="showScreen('lobby-screen')">RETURN TO MENU</button>
                </div>
            </div>
        </section>

        <!-- Extras Overlay -->
        <section id="extras-overlay" class="screen" style="backdrop-filter: blur(5px);">
            <div class="cyber-panel" style="width: 700px; max-width: 90%;">
                <h2 style="margin-bottom: 2rem; border-bottom: 1px solid var(--neon-yellow); color: var(--neon-yellow); padding-bottom: 1rem;">MISSION ARCHIVES</h2>
                <div style="color: var(--text-muted); line-height: 1.8; font-size: 1rem; max-height: 300px; overflow-y: auto; padding-right: 1rem;">
                    <p style="margin-bottom: 1rem;">
                        <strong>OBJECTIVE:</strong> Train operatives in defensive and offensive cyber-tactics.
                    </p>
                    <p style="margin-bottom: 1rem;">
                        <strong>SIMULATION PARAMETERS:</strong> Operatives are placed in a controlled digital environment ("The City") where they must execute or deflect social engineering attacks.
                    </p>
                    <p>
                        All scenarios are based on real-world threat intelligence. Proceed with caution.
                    </p>
                </div>
                <div style="margin-top: 2rem; text-align: center;">
                    <button class="btn secondary" onclick="showScreen('lobby-screen')">CLOSE ARCHIVE</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Room Selection (Formerly Game Lobby) -->
    <div id="roomSelectionScreen" class="hidden screen" style="background: var(--bg-darker); z-index: 50;">
        <div style="width: 100%; max-width: 900px; padding: 2rem;">
            <h1 style="text-align: center; margin-bottom: 3rem; font-size: 3rem;">CONNECTION HUB</h1>
            
            <div style="display: flex; justify-content: center; gap: 3rem; flex-wrap: wrap;">
                <!-- Create Room -->
                <div class="cyber-panel" style="width: 350px;">
                    <h3 style="text-align: center; margin-bottom: 1.5rem;">HOST NEW SESSION</h3>
                    <p style="color: var(--text-muted); margin-bottom: 1.5rem; text-align: center;">Initialize a secure channel for other operatives to join.</p>
                    <button id="createRoomBtn" class="btn" style="width: 100%;">INITIALIZE</button>
                </div>

                <!-- Join Room -->
                <div class="cyber-panel" style="width: 350px;">
                    <h3 style="text-align: center; margin-bottom: 1.5rem;">JOIN SESSION</h3>
                    <div style="margin-bottom: 1rem;">
                        <input type="text" id="roomIdInput" placeholder="ENTER CHANNEL ID">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <select id="roleSelect">
                            <option value="ATTACKER">ROLE: ATTACKER (RED)</option>
                            <option value="DEFENDER">ROLE: DEFENDER (BLUE)</option>
                        </select>
                    </div>
                    <button id="joinRoomBtn" class="btn secondary" style="width: 100%;">CONNECT</button>
                </div>
            </div>

            <div id="lobbyStatus" style="text-align: center; margin-top: 2rem; color: var(--neon-blue); font-family: var(--font-display);"></div>
            
            <div style="text-align: center; margin-top: 3rem;">
                <button class="btn" onclick="showScreen('lobby-screen'); hideGameComponents();" style="border-color: var(--text-muted); color: var(--text-muted);">DISCONNECT</button>
            </div>
        </div>
    </div>

    <!-- ATTACKER INTERFACE -->
    <div id="attackerGameArea" class="hidden game-area">
        <div class="game-header">
            <div class="header-left">
                <span class="role-badge attacker">‚öîÔ∏è ATTACKER</span>
                <span class="room-id">CHANNEL: <span id="atkRoomId" style="color: var(--text-main);">...</span></span>
            </div>
            <div class="header-center">
                <div style="font-family: var(--font-display); font-size: 1.2rem;">
                    ROUNDS: <span id="atkAttacksPerformed" style="color: var(--neon-blue);">0</span> / <span id="atkMaxAttacks">5</span>
                </div>
            </div>
            <div class="header-right">
                <div class="scores">
                    <span class="score attacker-score">üî¥ <span id="atkScore">0</span></span>
                    <span class="score defender-score">üîµ <span id="atkDefScore">0</span></span>
                </div>
                <button class="btn" style="padding: 5px 15px; font-size: 0.8rem;" onclick="exitToLobby()">ABORT</button>
            </div>
        </div>

        <div class="game-content">
            <!-- Phase 1: Level Selection -->
            <div id="atkLevelSelect" class="game-phase">
                <h2 style="border-bottom: 1px solid var(--neon-red); display: inline-block; padding-bottom: 5px;">SELECT TARGET ENVIRONMENT</h2>
                <div id="levelCards" class="selection-grid">
                    <!-- Dynamic Content -->
                </div>
            </div>

            <!-- Phase 2: Target Profile -->
            <div id="atkProfileInfo" class="game-phase hidden">
                <h2 style="margin-bottom: 1rem;">TARGET ACQUIRED</h2>
                <div class="profile-display">
                    <div class="profile-avatar" id="targetAvatar">üë§</div>
                    <div class="profile-details" style="flex: 1;">
                        <h3 id="targetName" style="color: var(--neon-blue); font-size: 2rem; margin-bottom: 0.5rem;">LOADING...</h3>
                        <p id="targetDescription" style="color: var(--text-muted); font-style: italic; margin-bottom: 1.5rem;"></p>
                        <div class="profile-stats">
                            <div class="stat"><span class="stat-label">Age Group:</span> <span id="targetAgeGroup">-</span></div>
                            <div class="stat"><span class="stat-label">Occupation:</span> <span id="targetOccupation">-</span></div>
                            <div class="stat"><span class="stat-label">Tech Proficiency:</span> <span id="targetTechLevel">-</span></div>
                            <div class="stat"><span class="stat-label">Vulnerability:</span> <span id="targetMentalState">-</span></div>
                            <div class="stat"><span class="stat-label">Financial:</span> <span id="targetFinancialStatus">-</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 3: Attack Type -->
            <div id="atkTypeSelect" class="game-phase hidden">
                <h2 style="border-bottom: 1px solid var(--neon-red); display: inline-block; padding-bottom: 5px;">SELECT ATTACK VECTOR</h2>
                <p style="color: var(--text-muted); margin-top: 0.5rem;">Choose the optimal vulnerability to exploit.</p>
                <div id="attackTypeCards" class="selection-grid" style="margin-top: 1.5rem;">
                    <!-- Dynamic Content -->
                </div>
            </div>

            <!-- Phase 4: Attack Option -->
            <div id="atkOptionSelect" class="game-phase hidden">
                 <h2 style="border-bottom: 1px solid var(--neon-red); display: inline-block; padding-bottom: 5px;">CONFIGURE PAYLOAD</h2>
                 <p style="color: var(--text-muted); margin-top: 0.5rem;">Select the specific method of execution.</p>
                <div id="attackOptionCards" class="selection-grid" style="margin-top: 1.5rem;">
                    <!-- Dynamic Content -->
                </div>
            </div>

            <!-- Phase 5: Waiting -->
            <div id="atkWaiting" class="game-phase hidden" style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <div class="loader"></div>
                <h2 style="margin-top: 2rem; color: var(--neon-blue);">ATTACK IN PROGRESS</h2>
                <p id="attackLaunchedMsg" style="color: var(--text-muted); letter-spacing: 2px; margin-top: 1rem;">Awaiting Defender Response...</p>
                <div class="cyber-panel" style="margin-top: 3rem; max-width: 600px; width: 100%;">
                    <div style="font-size: 0.8rem; color: var(--neon-red); letter-spacing: 2px; margin-bottom: 1rem;">// EXECUTING PAYLOAD:</div>
                    <div id="attackPreviewContent" style="color: var(--text-main); font-family: monospace;"></div>
                </div>
            </div>

            <!-- Phase 6: Outcome -->
            <div id="atkOutcome" class="game-phase hidden" style="text-align: center; margin-top: 5vh;">
                <div class="cyber-panel" style="display: inline-block; width: 80%; max-width: 700px;">
                    <h2 style="font-size: 3rem; margin-bottom: 2rem;">ROUND STATUS</h2>
                    <div id="outcomeMessage" style="font-size: 1.5rem; margin-bottom: 2rem; min-height: 3em;"></div>
                    
                    <div style="display: flex; justify-content: center; gap: 4rem; margin-bottom: 3rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: var(--text-muted);">ATTACKER</div>
                            <div id="atkScoreDelta" style="font-size: 2.5rem; color: var(--neon-red); font-weight: bold;">+0</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: var(--text-muted);">DEFENDER</div>
                            <div id="defScoreDelta" style="font-size: 2.5rem; color: var(--neon-green); font-weight: bold;">+0</div>
                        </div>
                    </div>

                    <button class="btn" onclick="nextRound()">INITIATE NEXT CYCLE</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DEFENDER INTERFACE -->
    <div id="defenderGameArea" class="hidden game-area">
        <div class="game-header">
             <div class="header-left">
                <span class="role-badge defender">üõ°Ô∏è DEFENDER</span>
                <span class="room-id">CHANNEL: <span id="defRoomId" style="color: var(--text-main);">...</span></span>
            </div>
             <div class="header-center">
                <div style="font-family: var(--font-display); font-size: 1.2rem;">
                    INTRUSIONS: <span id="defAttacksPerformed" style="color: var(--neon-blue);">0</span> / <span id="defMaxAttacks">5</span>
                </div>
            </div>
            <div class="header-right">
                <div class="scores">
                    <span class="score defender-score">üîµ <span id="defScore">0</span></span>
                    <span class="score attacker-score">üî¥ <span id="defAtkScore">0</span></span>
                </div>
                <button class="btn" style="padding: 5px 15px; font-size: 0.8rem;" onclick="exitToLobby()">ABORT</button>
            </div>
        </div>

        <div class="game-content">
            <!-- Phase 1: Waiting -->
            <div id="defWaiting" class="game-phase" style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <div class="loader" style="border-color: rgba(0, 255, 157, 0.3); border-top-color: var(--neon-green);"></div>
                <h2 style="margin-top: 2rem; color: var(--neon-green);">SYSTEM MONITORING</h2>
                <p style="color: var(--text-muted); letter-spacing: 2px; margin-top: 1rem;">Scanning for incoming threats...</p>

                <!-- Profile Info -->
                <div id="defenderProfileDisplay" class="hidden" style="margin-top: 3rem; width: 100%; max-width: 800px;">
                    <div class="profile-display" style="border-color: var(--neon-green);">
                         <div class="profile-details" style="flex: 1;">
                            <h3 style="color: var(--neon-green); font-size: 1.5rem; margin-bottom: 0.5rem;">YOUR DIGITAL IDENTITY</h3>
                             <p id="defProfileDescription" style="color: var(--text-muted); font-style: italic; margin-bottom: 1.5rem;"></p>
                             <div class="profile-stats">
                                <div class="stat"><span class="stat-label">Name:</span> <span id="defProfileName">-</span></div>
                                <div class="stat"><span class="stat-label">Occupation:</span> <span id="defProfileOccupation">-</span></div>
                                <div class="stat"><span class="stat-label">Tech Level:</span> <span id="defProfileTechLevel">-</span></div>
                                <div class="stat"><span class="stat-label">Stress:</span> <span id="defProfileMentalState">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 2: Under Attack -->
            <div id="defUnderAttack" class="game-phase hidden">
                <div style="background: rgba(255, 42, 42, 0.1); border: 1px solid var(--neon-red); padding: 1rem; text-align: center; margin-bottom: 2rem; animation: pulse-red 2s infinite;">
                    <h2 style="color: var(--neon-red); margin: 0;">‚ö†Ô∏è THREAT DETECTED ‚ö†Ô∏è</h2>
                </div>

                <div class="cyber-panel" style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.5rem;">
                         <span style="color: var(--text-muted);">SOURCE:</span>
                         <span id="attackSender" style="color: var(--neon-blue); font-weight: bold;">UNKNOWN</span>
                    </div>
                    <div id="attackMessage" style="font-size: 1.2rem; line-height: 1.6;">
                        Loading packet content...
                    </div>
                </div>

                <h3 style="margin-bottom: 1.5rem; color: var(--neon-green);">SELECT COUNTERMEASURE:</h3>
                <div id="defenderChoices" class="selection-grid">
                    <!-- Dynamic Choices -->
                </div>
            </div>

            <!-- Phase 3: Outcome -->
            <div id="defOutcome" class="game-phase hidden" style="text-align: center; margin-top: 5vh;">
                <div class="cyber-panel" style="display: inline-block; width: 80%; max-width: 700px; border-color: var(--neon-green);">
                    <h2 id="defOutcomeTitle" style="font-size: 3rem; margin-bottom: 2rem;">ANALYSIS COMPLETE</h2>
                    <div id="defOutcomeMessage" style="font-size: 1.5rem; margin-bottom: 1rem;"></div>
                    
                    <div id="educationalNote" style="background: rgba(0, 255, 157, 0.05); padding: 1rem; margin-bottom: 2rem; border-left: 3px solid var(--neon-green); text-align: left;">
                    </div>

                    <div style="display: flex; justify-content: center; gap: 4rem; margin-bottom: 3rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: var(--text-muted);">DEFENDER</div>
                            <div id="defDefenderScoreDelta" style="font-size: 2.5rem; color: var(--neon-green); font-weight: bold;">+0</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: var(--text-muted);">ATTACKER</div>
                            <div id="defAttackerScoreDelta" style="font-size: 2.5rem; color: var(--neon-red); font-weight: bold;">+0</div>
                        </div>
                    </div>

                    <button class="btn secondary" onclick="defenderContinue()">RESUME MONITORING</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="hidden screen" style="background: rgba(0,0,0,0.95); z-index: 2000;">
        <div class="cyber-panel" style="width: 700px; max-width: 95%; text-align: center; border-width: 2px;">
            <h1 id="gameOverTitle" style="font-size: 4rem; margin-bottom: 1rem; text-shadow: 0 0 30px currentColor;">MISSION END</h1>
            <p id="gameOverSubtitle" style="color: var(--text-muted); font-size: 1.2rem; margin-bottom: 3rem;">SIMULATION SETTLED</p>

            <div style="display: flex; justify-content: center; gap: 4rem; margin-bottom: 3rem;">
                <div>
                    <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem;">DEFENDER SCORE</div>
                    <div id="finalDefenderScore" style="font-size: 3.5rem; color: var(--neon-green); font-family: var(--font-display);">0</div>
                </div>
                <div>
                    <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem;">ATTACKER SCORE</div>
                    <div id="finalAttackerScore" style="font-size: 3.5rem; color: var(--neon-red); font-family: var(--font-display);">0</div>
                </div>
            </div>

            <div style="text-align: left; margin-bottom: 3rem; max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 1rem;">
                <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--neon-yellow);">DEBRIEFING / KEY LEARNINGS</h3>
                <div id="lessonsLearned" style="color: var(--text-main); font-size: 0.9rem;"></div>
            </div>

            <button class="btn" onclick="exitToLobby()" style="width: 100%;">RETURN TO BASE</button>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/game.js"></script>
</body>
</html>