<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberWalk - Interactive Story Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="app">
        <div id="transitionOverlay" class="transition-overlay"></div>
        <!-- Loading Screen -->
        <section id="loading-screen" class="screen active">
            <div class="loader"></div>
            <p style="letter-spacing: 4px; font-weight: 800; font-size: 0.8rem; color: var(--accent-blue);">INITIALIZING
                SYSTEM...</p>
        </section>

        <!-- New Lobby Screen -->
        <section id="lobby-screen" class="screen">
            <div class="lobby-content" style="position: absolute; bottom: 10%; width: 100%; padding: 0 5%;">
                <h1
                    style="font-size: 8rem; font-weight: 800; letter-spacing: -2px; margin-bottom: 2rem; color: var(--accent-blue); text-shadow: 0 0 30px rgba(0, 210, 255, 0.5);">
                    CYBERWALK</h1>
                <div class="menu-items" style="display: flex; gap: 20px;">
                    <button class="btn" onclick="startGame()">Play</button>
                    <button class="btn" onclick="window.location.href='editor.html'">Level Editor</button>
                    <button class="btn" onclick="showScreen('settings-overlay')">Settings</button>
                    <button class="btn secondary" onclick="showScreen('extras-overlay')">Extras</button>
                    <button class="btn" onclick="window.location.href='/logout'">Logout</button>
                    <button class="btn" onclick="exitGame()">Exit Game</button>
                </div>
            </div>
        </section>

        <!-- Settings Overlay -->
        <section id="settings-overlay" class="screen glass">
            <div class="modal-content" style="width: 80%; max-width: 800px; padding: 40px;">
                <h2
                    style="font-size: 3rem; margin-bottom: 2rem; border-bottom: 2px solid var(--accent-blue); padding-bottom: 1rem;">
                    SETTINGS</h2>

                <div class="setting-group" style="margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <label>GLOBAL VOLUME</label>
                        <span id="volume-val">80%</span>
                    </div>
                    <input type="range" id="volume-slider" min="0" max="100" value="80"
                        oninput="updateSetting('volume', this.value)">
                </div>

                <div class="setting-group" style="margin-bottom: 3rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <label>SCREEN BRIGHTNESS</label>
                        <span id="brightness-val">100%</span>
                    </div>
                    <input type="range" id="brightness-slider" min="50" max="150" value="100"
                        oninput="updateSetting('brightness', this.value)">
                </div>

                <button class="btn" onclick="showScreen('lobby-screen')">Back to Lobby</button>
            </div>
        </section>

        <!-- Extras Overlay -->
        <section id="extras-overlay" class="screen glass">
            <div class="modal-content" style="width: 80%; max-width: 800px; padding: 40px; text-align: left;">
                <h2
                    style="font-size: 3rem; margin-bottom: 2rem; border-bottom: 2px solid var(--accent-orange); padding-bottom: 1rem;">
                    EXTRAS</h2>
                <div style="color: var(--text-secondary); line-height: 1.6; font-size: 1.1rem;">
                    <p style="margin-bottom: 1.5rem;"><strong>Version:</strong> 1.0.15681</p>
                    <p style="margin-bottom: 1.5rem;"><strong>Developer Notes:</strong> DISPATCH is a tactical narrative
                        experience set in a near-future metropolitan area. Experience the life of an emergency responder
                        in a world of high-tech surveillance and complex human stories.</p>
                    <p>All assets and UI elements are designed to provide a seamless cinematic experience.</p>
                </div>
                <button class="btn secondary" style="margin-top: 3rem;"
                    onclick="showScreen('lobby-screen')">Back</button>
            </div>
        </section>
    </div>

    <!-- Existing Game (Hidden initially) -->
    <!-- Room Selection Screen (Formerly lobbyScreen) -->
    <div id="roomSelectionScreen" class="hidden">
        <h1>CyberWalk: Duel Mode</h1>
        <div class="lobby-controls">
            <div class="card">
                <h3>Create Room</h3>
                <button id="createRoomBtn" class="btn btn-primary">Create New Room</button>
            </div>
            <div class="card">
                <h3>Join Room</h3>
                <input type="text" id="roomIdInput" placeholder="Enter Room ID">
                <select id="roleSelect">
                    <option value="ATTACKER">Attacker (Red Team)</option>
                    <option value="DEFENDER">Defender (Blue Team)</option>
                </select>
                <button id="joinRoomBtn" class="btn btn-secondary">Join Game</button>
            </div>
        </div>
        <div id="lobbyStatus" class="status-msg"></div>
        <!-- Back Button for Navigation -->
        <button class="btn" onclick="showScreen('lobby-screen'); hideGameComponents();" style="margin-top: 2rem;">Back
            to Main Menu</button>
    </div>

    <!-- NEW: Attacker Game Interface -->
    <div id="attackerGameArea" class="hidden game-area">
        <div class="game-header attacker-header">
            <div class="header-left">
                <span class="role-badge attacker">‚öîÔ∏è ATTACKER</span>
                <span class="room-id">Room: <span id="atkRoomId"></span></span>
            </div>
            <div class="header-center">
                <div class="round-info">
                    Attacks: <span id="atkAttacksPerformed">0</span> / <span id="atkMaxAttacks">5</span>
                </div>
            </div>
            <div class="header-right">
                <div class="scores">
                    <span class="score attacker-score">üî¥ <span id="atkScore">0</span></span>
                    <span class="score defender-score">üîµ <span id="atkDefScore">0</span></span>
                </div>
                <button class="btn btn-small exit-btn" onclick="exitToLobby()">Exit</button>
            </div>
        </div>

        <div class="game-content">
            <!-- Phase: Level Selection -->
            <div id="atkLevelSelect" class="game-phase">
                <h2 class="phase-title">Select Target Environment</h2>
                <div id="levelCards" class="selection-grid">
                    <!-- Loaded dynamically -->
                </div>
            </div>

            <!-- Phase: Target Profile Info -->
            <div id="atkProfileInfo" class="game-phase hidden">
                <h2 class="phase-title">Target Profile</h2>
                <div class="profile-display">
                    <div class="profile-avatar" id="targetAvatar">üë§</div>
                    <div class="profile-details">
                        <h3 id="targetName">Loading...</h3>
                        <p id="targetDescription"></p>
                        <div class="profile-stats">
                            <div class="stat"><span class="stat-label">Age:</span> <span id="targetAge">-</span></div>
                            <div class="stat"><span class="stat-label">Age Group:</span> <span id="targetAgeGroup">-</span></div>
                            <div class="stat"><span class="stat-label">Occupation:</span> <span id="targetOccupation">-</span></div>
                            <div class="stat"><span class="stat-label">Tech Level:</span> <span id="targetTechLevel">-</span></div>
                            <div class="stat"><span class="stat-label">Mental State:</span> <span id="targetMentalState">-</span></div>
                            <div class="stat"><span class="stat-label">Financial Status:</span> <span id="targetFinancialStatus">-</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase: Attack Type Selection -->
            <div id="atkTypeSelect" class="game-phase hidden">
                <h2 class="phase-title">Choose Attack Vector</h2>
                <p class="phase-description">Select how you want to attack the target</p>
                <div id="attackTypeCards" class="selection-grid">
                    <!-- Loaded dynamically -->
                </div>
            </div>

            <!-- Phase: Attack Option Selection -->
            <div id="atkOptionSelect" class="game-phase hidden">
                <h2 class="phase-title">Configure Your Attack</h2>
                <p class="phase-description">Choose your specific approach</p>
                <div id="attackOptionCards" class="selection-grid options-grid">
                    <!-- Loaded dynamically -->
                </div>
            </div>

            <!-- Phase: Waiting for Defender -->
            <div id="atkWaiting" class="game-phase hidden">
                <div class="waiting-display">
                    <div class="spinner"></div>
                    <h2>Attack Launched!</h2>
                    <p id="attackLaunchedMsg">Waiting for defender to respond...</p>
                    <div class="attack-preview">
                        <div class="preview-label">Your Attack:</div>
                        <div id="attackPreviewContent" class="preview-content"></div>
                    </div>
                </div>
            </div>

            <!-- Phase: Outcome Display -->
            <div id="atkOutcome" class="game-phase hidden">
                <div class="outcome-display">
                    <h2>Round Result</h2>
                    <div id="outcomeMessage" class="outcome-message"></div>
                    <div class="score-change">
                        <div class="score-delta attacker"><span id="atkScoreDelta">+0</span></div>
                        <div class="score-delta defender"><span id="defScoreDelta">+0</span></div>
                    </div>
                    <button class="btn btn-primary" onclick="nextRound()">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Defender Game Interface -->
    <div id="defenderGameArea" class="hidden game-area">
        <div class="game-header defender-header">
            <div class="header-left">
                <span class="role-badge defender">üõ°Ô∏è DEFENDER</span>
                <span class="room-id">Room: <span id="defRoomId"></span></span>
            </div>
            <div class="header-center">
                <div class="round-info">
                    Attacks: <span id="defAttacksPerformed">0</span> / <span id="defMaxAttacks">5</span>
                </div>
            </div>
            <div class="header-right">
                <div class="scores">
                    <span class="score defender-score">üîµ <span id="defScore">0</span></span>
                    <span class="score attacker-score">üî¥ <span id="defAtkScore">0</span></span>
                </div>
                <button class="btn btn-small exit-btn" onclick="exitToLobby()">Exit</button>
            </div>
        </div>

        <div class="game-content">
            <!-- Phase: Waiting for Attacker -->
            <div id="defWaiting" class="game-phase">
                <div class="waiting-display">
                    <div class="spinner"></div>
                    <h2>Standing By...</h2>
                    <p>Waiting for attacker to launch their attack</p>
                    
                    <!-- Defender Profile Display -->
                    <div id="defenderProfileDisplay" class="profile-display" style="margin-top: 2rem; display: none;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 1rem;">Your Profile</h3>
                        <div class="profile-details" style="background: rgba(0, 210, 255, 0.1); padding: 1.5rem; border-radius: 8px;">
                            <div class="profile-stats">
                                <div class="stat"><span class="stat-label">Name:</span> <span id="defProfileName">-</span></div>
                                <div class="stat"><span class="stat-label">Age:</span> <span id="defProfileAge">-</span></div>
                                <div class="stat"><span class="stat-label">Age Group:</span> <span id="defProfileAgeGroup">-</span></div>
                                <div class="stat"><span class="stat-label">Occupation:</span> <span id="defProfileOccupation">-</span></div>
                                <div class="stat"><span class="stat-label">Tech Level:</span> <span id="defProfileTechLevel">-</span></div>
                                <div class="stat"><span class="stat-label">Mental State:</span> <span id="defProfileMentalState">-</span></div>
                                <div class="stat"><span class="stat-label">Financial Status:</span> <span id="defProfileFinancialStatus">-</span></div>
                            </div>
                            <p id="defProfileDescription" style="margin-top: 1rem; font-style: italic; color: var(--text-secondary);"></p>
                        </div>
                    </div>
                    
                    <div class="defender-tips">
                        <h4>üîí Security Tips While You Wait:</h4>
                        <ul>
                            <li>Never share passwords or OTPs with anyone</li>
                            <li>Verify caller identity through official channels</li>
                            <li>Check URLs carefully before clicking</li>
                            <li>When in doubt, hang up and call back</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Phase: Under Attack - Response Required -->
            <div id="defUnderAttack" class="game-phase hidden">
                <div class="attack-notification">
                    <div class="alert-icon">‚ö†Ô∏è</div>
                    <h2>Incoming Communication!</h2>
                </div>
                
                <div class="attack-content">
                    <div class="sender-info">
                        <span class="sender-label">From:</span>
                        <span id="attackSender" class="sender-name">Unknown</span>
                    </div>
                    <div class="message-box">
                        <p id="attackMessage">Loading message...</p>
                    </div>
                </div>

                <div class="response-section">
                    <h3>How do you respond?</h3>
                    <div id="defenderChoices" class="choices-grid">
                        <!-- Loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Phase: Outcome Display -->
            <div id="defOutcome" class="game-phase hidden">
                <div class="outcome-display">
                    <h2 id="defOutcomeTitle">Result</h2>
                    <div id="defOutcomeMessage" class="outcome-message"></div>
                    <div class="educational-note" id="educationalNote">
                        <!-- Educational content -->
                    </div>
                    <div class="score-change">
                        <div class="score-delta defender"><span id="defScoreChange">+0</span></div>
                    </div>
                    <button class="btn btn-primary" onclick="defenderContinue()">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="hidden">
        <div class="game-over-content glass" style="max-width: 600px; width: 90%;">
            <h1 id="gameOverTitle" style="color: var(--accent-blue); margin-bottom: 1rem;">GAME OVER</h1>
            <p id="gameOverSubtitle" style="color: var(--text-secondary); margin-bottom: 2rem;"></p>

            <div class="final-scores"
                style="display: flex; justify-content: space-around; margin-bottom: 2rem; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                <div class="score-item">
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">DEFENDER</p>
                    <p id="finalDefenderScore" style="font-size: 2.5rem; font-weight: 800; color: #00ff7f;">0</p>
                </div>
                <div class="score-item">
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">ATTACKER</p>
                    <p id="finalAttackerScore" style="font-size: 2.5rem; font-weight: 800; color: #ff4b2b;">0</p>
                </div>
            </div>

            <div id="gameAnalysis" style="text-align: left; margin-bottom: 2rem;">
                <h3
                    style="font-size: 0.9rem; letter-spacing: 2px; color: var(--accent-orange); margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;">
                    SECURITY LESSONS</h3>
                <div id="lessonsLearned" style="color: var(--text-secondary); font-size: 0.9rem;">
                    <!-- Populated via JS -->
                </div>
            </div>

            <button id="restartButton" class="btn primary" style="width: 100%;" onclick="exitToLobby()">RETURN TO MAIN MENU</button>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/game.js"></script>
</body>

</html>